<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="docker,command.note">
    <meta name="description" content="docker简单学习笔记与docker命令备忘录">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>docker教程初版 | Qing</title>
    <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Qing</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Qing</div>
        <div class="logo-desc">
            
            这个人没啥子特点 喜欢一切随缘咯 ( •̀ ω •́ )✧
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/RobertSunq/RobertSunq.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/RobertSunq/RobertSunq.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('哟！你知道密码不？')).toString(CryptoJS.enc.Hex)) {
                alert('好可惜你不知道哎，那只能回到主页咯！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/11.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">docker教程初版</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/command/">
                                <span class="chip bg-color">command</span>
                            </a>
                        
                            <a href="/tags/note/">
                                <span class="chip bg-color">note</span>
                            </a>
                        
                            <a href="/tags/docker/">
                                <span class="chip bg-color">docker</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/DevOps/" class="post-category">
                                DevOps
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-12-25
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-01-03
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    10.6k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    47 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul>
<li>Docker概述</li>
<li>Docker安装</li>
<li>Docker命令<ul>
<li>镜像命令</li>
<li>容器命令</li>
<li>操作命令</li>
<li>….</li>
</ul>
</li>
<li>Docker镜像</li>
<li>容器数据卷</li>
<li>DockerFile</li>
<li>Docker网络原理</li>
<li>IDEA整合Docker</li>
</ul>
<ul>
<li>Docker Compose</li>
<li>Docker Swarm （简化版K8s）</li>
<li>CI/CD Jenkins</li>
</ul>
<h2 id="Docker概述"><a href="#Docker概述" class="headerlink" title="Docker概述"></a>Docker概述</h2><h3 id="痛点"><a href="#痛点" class="headerlink" title="痛点"></a>痛点</h3><p>开发、测试、预生产、生产环境搭建的成本和一致性问题。在进行集群拓展的时候，每个机器上都要进行环境的部署安装（Reids ES Hadoop……）等费时费力，而且还可能因为机器的不同而产生各种各样的不一致问题。</p>
<p>针对java开发来说，一般通过jar/war包来部署的，但是运行jar包所需要的其他环境依赖，比如：JDK、Tomcat、Mysql、Redis这些都需要在机器上事先的安装配置完成。</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>可以通过发包的时候直接带上软件运行所需要的环境和对环境的配置进行打包 “jar+”（app + jdk + mysql + redis + es），这样可以保证 开发 → 打包 → 部署 → 上线 所具有的环境保持一致，同时也可以避免在对新机器进行部署的时候，还需要进行复杂的环境配置。</p>
<p>Docker 便是这么一个类似的过程：打包项目带上环境（镜像） → 发布（Docker仓库）→ 下载发布的镜像 → 直接运行（容器）。</p>
<h4 id="虚拟机技术"><a href="#虚拟机技术" class="headerlink" title="虚拟机技术"></a>虚拟机技术</h4><p>虚拟化技术。可以直接通过虚拟机镜像文件，直接虚拟出一个具有完整环境的虚拟电脑，在其上面在运行所需要的App。</p>
<p><strong>缺点：</strong></p>
<p>对物理服务器资源的消耗，在物理服务器创建一台虚拟机时，便需要虚拟出一套硬件并在上面运行完整的操作系统，每台虚拟机都占用许多的服务器资源。是在<strong>物理层面上的隔离</strong>，启动慢 占用内存大，分钟级启动。当需要启动多个虚拟机时需要花费很大的时间</p>
<p><strong>物理资源层面上的隔离</strong></p>
<p><img src="/2021/12/25/devops/docker-notes/0012.png" alt="0012"></p>
<h4 id="Docker容器化技术"><a href="#Docker容器化技术" class="headerlink" title="Docker容器化技术"></a>Docker容器化技术</h4><p>也是一种虚拟化技术。镜像：包含所需要的最基础环境（最核心的Linux环境4M + 其他环境），没有其他额外的文件，只集成需要的便可以做到很小巧，启动运行镜像也十分快速，秒级别启动。</p>
<p><strong>优点：</strong></p>
<ul>
<li><p>传统虚拟机，虚拟出硬件，运行一个完整的操作系统，然后再这个系统上安装和运行软件，Docker并不是选择去模拟一个完整的操作系统</p>
</li>
<li><p>容器内的应用直接运行在宿主机的内核，容器时没有自己的内核的，并不去虚拟硬件所以十分的轻便</p>
</li>
<li><p>每个容器是相互隔离，每个容器都有一套自己的文件系统，互相不影响</p>
</li>
<li><p>更快速的交付和部署</p>
<ul>
<li>打包镜像发布测试 一键运行</li>
</ul>
</li>
<li><p>更便捷的升级和扩缩容</p>
<ul>
<li>在不同的机器上直接运行相同的镜像来扩容</li>
</ul>
</li>
<li><p>更简单的系统运维</p>
<ul>
<li>开发测试生产环境高度一致</li>
</ul>
</li>
<li><p>更高效的计算机资源利用</p>
</li>
</ul>
<p><strong>缺点：</strong></p>
<p>由于是<strong>操作系统进程层面上的隔离</strong>不是绝对的物理隔离，所以在安全性上时低于虚拟机的。</p>
<p><strong>操作系统进程层面上的隔离</strong></p>
<p><img src="/2021/12/25/devops/docker-notes/0013.png" alt="0013"></p>
<h4 id="基本组成"><a href="#基本组成" class="headerlink" title="基本组成"></a>基本组成</h4><p>C/S模式：docker-client，docker-service</p>
<p><img src="/2021/12/25/devops/docker-notes/0000.png" alt="0000"></p>
<p>Docker daemon（守护进程）：Docker Client通过命令行与Docker Damon通信，完成Docker相关操作</p>
<p>Images（镜像）：类似于软件安装包</p>
<p>Containers（容器）：软件的运行</p>
<p><strong>镜像（image）：</strong></p>
<p>在docker中，镜像就类似于一个模板，可以通过这个模板来创建容器服务，同时也可以通过这个镜像去创建多个容器（最终服务运行或者项目运行就是在容器中）。</p>
<pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid"><span class="token keyword">graph</span> TD
A<span class="token text string">[tomcat镜像]</span> <span class="token arrow operator">--&gt;</span> B<span class="token text string">[run]</span>
B <span class="token arrow operator">--&gt;</span> C<span class="token text string">[tomcat 1容器&lt;提供服务器&gt;]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<p><strong>容器（container）：</strong></p>
<p>Docker利用容器技术，独立运行一个或者一组应用，通过镜像来创建。</p>
<p>启动、停止、删除等基本命令！</p>
<p><strong>仓库（repository）：</strong></p>
<p>即存放镜像的地方，仓库分为私用仓库与公有仓库。但Docker Hub默认为国外服务器，所有可以通过配置为阿里云下镜像仓库来加速下载公用镜像。</p>
<h3 id="底层原理概述"><a href="#底层原理概述" class="headerlink" title="底层原理概述"></a>底层原理概述</h3><h4 id="核心思想"><a href="#核心思想" class="headerlink" title="核心思想"></a>核心思想</h4><ul>
<li>镜像<ul>
<li>将所有需要的内容放到不同的镜像（集装箱）中，需要哪些环境就直接拿哪个镜像（集装箱）就可以</li>
</ul>
</li>
<li>标准化<ul>
<li>镜像管理标准化，所有的镜像都放置于仓库中统一管理，当需要某些环境需要哪些镜像就使用docker去仓库中获取。</li>
<li>命令标准化，Docker提供了一系列的命令，来帮助我们对镜像进行一系列的操作</li>
</ul>
</li>
<li>隔离性<ul>
<li>运行镜像中的内容（容器）时，会在Linux的内核中单独开辟一片空间，这片空间不会影响到其他程序</li>
</ul>
</li>
</ul>
<h4 id="基本工作原理概述"><a href="#基本工作原理概述" class="headerlink" title="基本工作原理概述"></a>基本工作原理概述</h4><ol>
<li><p>Docker 是一个Client - Server结构的系统，Docker的守护进程运行在主机上。通过Socket从客户端访问！</p>
</li>
<li><p>DockerServer接收到Docker-Client的指令，就会执行这个命令！</p>
</li>
<li><p>容器内部的端口号是私有独立的，如果外部的想要访问，就需要通过linux服务器的端口号进行端口映射。</p>
</li>
</ol>
<p><img src="/2021/12/25/devops/docker-notes/0002.png" alt="0002"></p>
<p>Docker 为什么比VM快</p>
<ol>
<li><p>docker更少的抽象层</p>
</li>
<li><p>docker利用的是宿主机的内核，vm需要的是Guest OS</p>
</li>
</ol>
<p><img src="/2021/12/25/devops/docker-notes/0003.png" alt="0003"></p>
<p>所以新建一个容器的时候，docker 不需要像虚拟机一样重新加载操作系统内核，避免引导。虚拟机时加载Guest OS，分钟级别的，而docker时利用宿主机的操作系统，省略了这个复杂的过程，秒级。</p>
<p><img src="/2021/12/25/devops/docker-notes/0004.png" alt="0004"></p>
<h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h2><h4 id="环境查看"><a href="#环境查看" class="headerlink" title="环境查看"></a>环境查看</h4><p>已在centos7上进行安装为例</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 查看系统内核版本
[root@centos7 ~]$ uname -r<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 查看系统版本
[root@centos7 ~]$ cat /etc/os-release<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h4><p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/" title="install">官方手册</a> <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/">https://docs.docker.com/engine/install/</a></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">
# 1、卸载历史版本的docker
[root@centos7 ~]$ yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
                  
# 2、安装基础安装包
[root@centos7]$ yum install -y yum-utils
 
# 3、设置镜像仓库
# yum-config-manager \
#    --add-repo \
#     https://download.docker.com/linux/centos/docker-ce.repo # 默认是国外仓库
    
[root@centos7 ~]$ yum-config-manager \
    --add-repo \
    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo # 阿里云的镜像地址
    
# 4、更新yum
[root@centos7 ~]$ yum makecache fast

# 5、安装 ce--社区，ee--企业  核心、客户端、容器
[root@centos7 ~]$ yum install docker-ce docker-ce-cli containerd.io
# 指定版本 yum install docker-ce--&lt;VERSION_STRING&gt; docker-ce-cli--&lt;VERSION_STRING&gt; containerd.io
# 查看其他版本
# [root@centos7 ~]$ yum list docker-ce --showduplicates | sort -r

# 6、启动
[root@centos7 ~]$ systemctl start docker

# 7、验证docker是否启动成功
[root@centos7 ~]$ docker version
[root@centos7 ~]$ docker run hello-world

# 8、查看下载的镜像
[root@centos7 ~]$ docker images
REPOSITORY    TAG       IMAGE ID       CREATED        SIZE
hello-world   latest    d1165f221234   4 months ago   13.3kB

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2021/12/25/devops/docker-notes/0001.png" alt="0001"></p>
<h4 id="快速卸载"><a href="#快速卸载" class="headerlink" title="快速卸载"></a>快速卸载</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 1、卸载依赖 
[root@centos7 ~]$ yum remove docker-ce docker-ce-cli containerd.io

# 2、删除资源
[root@centos7 ~]$ rm -rf /var/lib/docker
[root@centos7 ~]$ rm -rf /var/lib/containerd

# /var/lib/docker docker的默认工作路径<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="镜像加速"><a href="#镜像加速" class="headerlink" title="镜像加速"></a>镜像加速</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 以阿里云为列
[root@centos7 ~]$ mkdir -p /etc/docker # 创建文件
# 编写配置文件 下面的地址需要换成阿里云中自己实例中创建的
[root@centos7 ~]$ tee /etc/docker/daemon.json &lt;&lt;-'EOF'
{
	"registry-mirrors":["https://qiyb9988.mirror.aliyuncs.com"]
}
EOF
[root@centos7 ~]$ systemctl daemon-reload # 编译配置文件
[root@centos7 ~]$ systemctl restart docker # 重启docker
[root@centos7 ~]$
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="Docker常用命令"><a href="#Docker常用命令" class="headerlink" title="Docker常用命令"></a>Docker常用命令</h2><h4 id="基本帮助"><a href="#基本帮助" class="headerlink" title="基本帮助"></a>基本帮助</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@centos7 ~]$ 

## 帮助文档 https://docs.docker.com/reference/
[root@centos7 ~]$ docker version #  显示docker版本信息
[root@centos7 ~]$ docker info # 显示docker的系统信息，包括镜像和容器的数量
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h4><p><a target="_blank" rel="noopener" href="https://docs.docker.com/reference/" title="reference">官方命令说明</a>  <a target="_blank" rel="noopener" href="https://docs.docker.com/reference/">https://docs.docker.com/reference/</a></p>
<p><a target="_blank" rel="noopener" href="https://hub.docker.com/" title="dockerHub">官方仓库</a>    <a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<p><strong>查看与搜索镜像</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing centos]$ docker images 
REPOSITORY    TAG       IMAGE ID       CREATED        SIZE
hello-world   latest    d1165f221234   4 months ago   13.3kB

#################################
# REPOSITORY	镜像的仓库源
# TAG			镜像的标签
# IMAGE ID		镜像的ID
# CREATED		镜像的创建时间
# SIZE			镜像的大小

# 可选项
#	--all , -a		查看所有镜像
#	--quiet , -q	只显示镜像ID
#################################

########################################################################
[root@qing centos]$ docker search mysql  # 搜索镜像
NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
mysql                             MySQL is a widely used, open-source relation…   11099     [OK]       
mariadb                           MariaDB Server is a high performing open sou…   4209      [OK]       

# 可选项，通过搜索来过滤
--filter=STARS=3000 # 搜索出来的镜像是STARS大于3000的
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><strong>下载镜像</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing centos]$ docker pull mysql  # 下载镜像

Using default tag: latest  # 不声明tag，默认时 latest
latest: Pulling from library/mysql
b4d181a07f80: Download complete  # 分层下载，docker image的核心 联合文件系统？
a462b60610f5: Download complete 
578fafb77ab8: Download complete 
524046006037: Download complete 
d0cbe54c8855: Download complete 
aa18e05cc46d: Download complete 
32ca814c833f: Download complete 
9ecc8abdb7f5: Download complete 
ad042b682e0f: Download complete 
71d327c6bb78: Download complete 
165d1d10a3fa: Download complete 
2f40c47d0626: Download complete 
Digest: sha256:52b8406e4c32b8cf0557f1b74517e14c5393aff5cf0384eff62d9e81f4985d4b #签名
Status: Downloaded newer image for mysql:latest
docker.io/library/mysql:latest	# 真实地址

######## 等价于
# docker pull musql
# docker pull docker.io/library/mysql:latest

################################
[root@qing centos]$ docker pull mysql:5.7  # 指定版本

5.7: Pulling from library/mysql
b4d181a07f80: Already exists # 共用分层文件，节省空间和下载速度，不用重复下载
a462b60610f5: Already exists 
578fafb77ab8: Already exists 
524046006037: Already exists 
d0cbe54c8855: Already exists 
aa18e05cc46d: Already exists 
32ca814c833f: Already exists 
52645b4af634: Pull complete 
bca6a5b14385: Pull complete 
309f36297c75: Pull complete 
7d75cacde0f8: Pull complete 
Digest: sha256:1a2f9cd257e75cc80e9118b303d1648366bc2049101449bf2c8d82b022ea86b7
Status: Downloaded newer image for mysql:5.7
docker.io/library/mysql:5.7
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><strong>删除镜像</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 删除镜像 rmi -&gt; remove image
[root@qing centos]$ docker rmi -f [image id]  # 删除指定镜像
[root@qing centos]$ docker rmi -f $(docker images -aq)  # 删除所有，${} 传递参数，查出所有的image id


# [root@qing centos]$ docker rmi -f (mysql5.7) 会发现只删除了mysql5.7不同的文件，和mysql8公用的部分并没有删除 
# 待确定？注意这里删除的是镜像，运行过的镜像创建的容器并没有被删除 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h4><blockquote>
<p>通过镜像来创建容器</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 以下载并启动 centos镜像为列子
[root@qing centos]$ docker pull centos<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>新建容器并启动</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing centos]$ docker run [可选参数] image

###################################################
# --name="name"		容器名字 tomcat01 tomcat02，用来区分容器
# -d				后台方式运行 ja nohup
# -it				使用交互方式运行，进入容器查看内容
	# -t	交互式操作
	# -i	终端
# -p				指定容器的端口 -p 8080:8080
	# -p 主机端口：容器端口  (常用)
	# -p ip:主机端口:容器端口
	# -p 容器端口
	# 容器端口
# -P				随机指定端口

###################################################
# 启动并进入容器
[root@qing centos]$ docker run -it centos /bin/bash
# 放在镜像名后的是命令，打开一个交互式 Shell，因此用的是 /bin/bash。
[root@75dcc58b2b3d /]$ ls	# 此时主机已经指向启动的容器，此时centos为基础版本。
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
[root@75dcc58b2b3d /]$ exit	# 从容器中退出
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2021/12/25/devops/docker-notes/0014.png" alt="0014"></p>
<p><strong>查看所有运行的容器</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ docker ps	# 查看运行中的容器
###################################################
#		列出当前正在运行的容器
# -a	列出当前正在运行的容器+历史运行过的容器
# -n=?	显示最近创建的容器个数
# -q	只显示容器的编号

###################################################
[root@qing /]$ docker ps -a	# 查看所有运行过的容器
CONTAINER ID   IMAGE         COMMAND       CREATED         STATUS                       PORTS     NAMES
3c8ef01a7eb6   centos        "/bin/bash"   6 minutes ago   Exited (130) 5 minutes ago             nice_austin
ceafc51e6972   hello-world   "/hello"      2 days ago      Exited (0) 2 days ago                  focused_burnell

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><strong>退出容器</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># exit 停止当前容器并退出
# Ctrl + P + Q 仅退出当前容器，不停止运行<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<p><strong>删除容器</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ docker rm 容器id			# 删除指定容器，不能删除正在运行的容器 rm -f 强制删除
[root@qing /]$ docker rm -f $(docker ps -aq)# 删除所有容器
[root@qing /]$ docker ps -a -q|xargs docker rm	# 删除所有的容器<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<p><strong>启动和停止容器</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ docker start 容器id	# 启动容器
[root@qing /]$ docker restart 容器id	# 重启容器
[root@qing /]$ docker stop 容器id		# 停止当前正在运行的容器
[root@qing /]$ docker kill 容器id		# 强制停止容器
[root@qing /]$ docker start 容器id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<hr>
<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><p><strong>后台启动</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 命令 docker run -d 镜像名！
[root@qing /]$ docker run -d centos		# 后台启动

# 输入docker ps ， 发现centos停止了

# 常见的坑：
	# docker容器使用后台运行，就必须要有一个前台的进程，docker发现没有应用，就会自动停止
	# nginx，容器启动后，发现自己没有提供服务，就会立刻停止，就没有程序了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><strong>查看日志</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ docker logs --help
[root@qing /]$ docker logs	-tf --tail 10 容器id	# -f 保留打印窗口，-t 添加时间戳 --tail 10 最后10行

# 自定义shell脚本
# "while true;do echo qing;sleep 1; done"
# [root@qing /]$ docker run -d centos /bin/sh -c "while true;do echo qing;sleep 1;done"
# -c 执行命令


[root@qing /]$ docker top 容器id		# 查看容器内进程信息
UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD
root                32718               32697               33                  23:07               ?                   00:00:23            /bin/sh -c while true;do echo qing;sheep 1;done

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<p><strong>查看容器元数据</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ docker inspect 容器id		# 查看容器信息

# "Id" 比通过ps查询到的要长，ps中只是对其进行了部分截取<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<details>
  <summary>
      <mark>
          <font color="green">详细输出</font>
      </mark>
    </summary>
  <p>[root@qing /]$ docker inspect ${container id}</p>
  <pre>  <code>  
[
    {
        "Id": "2d2c8f54b427a6bfe6add93ab155be8879bbe54e0a7f5de66f5f3a79810ac0a4",
        "Created": "2021-12-28T15:07:57.17357075Z",
        "Path": "/bin/sh",
        "Args": [
            "-c",
            "while true;do echo qing;sheep 1;done"
        ],
        "State": {
            "Status": "running",
            "Running": true,
            "Paused": false,
            "Restarting": false,
            "OOMKilled": false,
            "Dead": false,
            "Pid": 32718,
            "ExitCode": 0,
            "Error": "",
            "StartedAt": "2021-12-28T15:07:57.691697573Z",
            "FinishedAt": "0001-01-01T00:00:00Z"
        },
        "Image": "sha256:5d0da3dc976460b72c77d94c8a1ad043720b0416bfc16c52c45d4847e53fadb6",
        "ResolvConfPath": "/var/lib/docker/containers/2d2c8f54b427a6bfe6add93ab155be8879bbe54e0a7f5de66f5f3a79810ac0a4/resolv.conf",
        "HostnamePath": "/var/lib/docker/containers/2d2c8f54b427a6bfe6add93ab155be8879bbe54e0a7f5de66f5f3a79810ac0a4/hostname",
        "HostsPath": "/var/lib/docker/containers/2d2c8f54b427a6bfe6add93ab155be8879bbe54e0a7f5de66f5f3a79810ac0a4/hosts",
        "LogPath": "/var/lib/docker/containers/2d2c8f54b427a6bfe6add93ab155be8879bbe54e0a7f5de66f5f3a79810ac0a4/2d2c8f54b427a6bfe6add93ab155be8879bbe54e0a7f5de66f5f3a79810ac0a4-json.log",
        "Name": "/jovial_davinci",
        "RestartCount": 0,
        "Driver": "overlay2",
        "Platform": "linux",
        "MountLabel": "",
        "ProcessLabel": "",
        "AppArmorProfile": "",
        "ExecIDs": null,
        "HostConfig": {
            "Binds": null,
            "ContainerIDFile": "",
            "LogConfig": {
                "Type": "json-file",
                "Config": {}
            },
            "NetworkMode": "default",
            "PortBindings": {},
            "RestartPolicy": {
                "Name": "no",
                "MaximumRetryCount": 0
            },
            "AutoRemove": false,
            "VolumeDriver": "",
            "VolumesFrom": null,
            "CapAdd": null,
            "CapDrop": null,
            "CgroupnsMode": "host",
            "Dns": [],
            "DnsOptions": [],
            "DnsSearch": [],
            "ExtraHosts": null,
            "GroupAdd": null,
            "IpcMode": "private",
            "Cgroup": "",
            "Links": null,
            "OomScoreAdj": 0,
            "PidMode": "",
            "Privileged": false,
            "PublishAllPorts": false,
            "ReadonlyRootfs": false,
            "SecurityOpt": null,
            "UTSMode": "",
            "UsernsMode": "",
            "ShmSize": 67108864,
            "Runtime": "runc",
            "ConsoleSize": [
                0,
                0
            ],
            "Isolation": "",
            "CpuShares": 0,
            "Memory": 0,
            "NanoCpus": 0,
            "CgroupParent": "",
            "BlkioWeight": 0,
            "BlkioWeightDevice": [],
            "BlkioDeviceReadBps": null,
            "BlkioDeviceWriteBps": null,
            "BlkioDeviceReadIOps": null,
            "BlkioDeviceWriteIOps": null,
            "CpuPeriod": 0,
            "CpuQuota": 0,
            "CpuRealtimePeriod": 0,
            "CpuRealtimeRuntime": 0,
            "CpusetCpus": "",
            "CpusetMems": "",
            "Devices": [],
            "DeviceCgroupRules": null,
            "DeviceRequests": null,
            "KernelMemory": 0,
            "KernelMemoryTCP": 0,
            "MemoryReservation": 0,
            "MemorySwap": 0,
            "MemorySwappiness": null,
            "OomKillDisable": false,
            "PidsLimit": null,
            "Ulimits": null,
            "CpuCount": 0,
            "CpuPercent": 0,
            "IOMaximumIOps": 0,
            "IOMaximumBandwidth": 0,
            "MaskedPaths": [
                "/proc/asound",
                "/proc/acpi",
                "/proc/kcore",
                "/proc/keys",
                "/proc/latency_stats",
                "/proc/timer_list",
                "/proc/timer_stats",
                "/proc/sched_debug",
                "/proc/scsi",
                "/sys/firmware"
            ],
            "ReadonlyPaths": [
                "/proc/bus",
                "/proc/fs",
                "/proc/irq",
                "/proc/sys",
                "/proc/sysrq-trigger"
            ]
        },
        "GraphDriver": {
            "Data": {
                "LowerDir": "/var/lib/docker/overlay2/5070e57b3b1ab1533ba4b1a8cb7de79e3655f6d78ba43c4640c2d25cedb00fa5-init/diff:/var/lib/docker/overlay2/0e6d8ab67489cffea7560a7fdc382658d599dc415839d4bf5f4d6c2b71dadf79/diff",
                "MergedDir": "/var/lib/docker/overlay2/5070e57b3b1ab1533ba4b1a8cb7de79e3655f6d78ba43c4640c2d25cedb00fa5/merged",
                "UpperDir": "/var/lib/docker/overlay2/5070e57b3b1ab1533ba4b1a8cb7de79e3655f6d78ba43c4640c2d25cedb00fa5/diff",
                "WorkDir": "/var/lib/docker/overlay2/5070e57b3b1ab1533ba4b1a8cb7de79e3655f6d78ba43c4640c2d25cedb00fa5/work"
            },
            "Name": "overlay2"
        },
        "Mounts": [],
        "Config": {
            "Hostname": "2d2c8f54b427",
            "Domainname": "",
            "User": "",
            "AttachStdin": false,
            "AttachStdout": false,
            "AttachStderr": false,
            "Tty": false,
            "OpenStdin": false,
            "StdinOnce": false,
            "Env": [
                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
            ],
            "Cmd": [
                "/bin/sh",
                "-c",
                "while true;do echo qing;sheep 1;done"
            ],
            "Image": "centos",
            "Volumes": null,
            "WorkingDir": "",
            "Entrypoint": null,
            "OnBuild": null,
            "Labels": {
                "org.label-schema.build-date": "20210915",
                "org.label-schema.license": "GPLv2",
                "org.label-schema.name": "CentOS Base Image",
                "org.label-schema.schema-version": "1.0",
                "org.label-schema.vendor": "CentOS"
            }
        },
        "NetworkSettings": {
            "Bridge": "",
            "SandboxID": "6ef9320864e6daa4195b284e3c60fb56edb95be77010eda7cff755ab315cffeb",
            "HairpinMode": false,
            "LinkLocalIPv6Address": "",
            "LinkLocalIPv6PrefixLen": 0,
            "Ports": {},
            "SandboxKey": "/var/run/docker/netns/6ef9320864e6",
            "SecondaryIPAddresses": null,
            "SecondaryIPv6Addresses": null,
            "EndpointID": "3d08880669d8a5f2ad913bef248471a0377eeeb7793f83450cd514d0b43e7a39",
            "Gateway": "172.18.0.1",
            "GlobalIPv6Address": "",
            "GlobalIPv6PrefixLen": 0,
            "IPAddress": "172.18.0.2",
            "IPPrefixLen": 16,
            "IPv6Gateway": "",
            "MacAddress": "02:42:ac:12:00:02",
            "Networks": {
                "bridge": {
                    "IPAMConfig": null,
                    "Links": null,
                    "Aliases": null,
                    "NetworkID": "73abca2ea3673a8f7f4919d8141708a47bc0851025083aefa25a3bec6286704d",
                    "EndpointID": "3d08880669d8a5f2ad913bef248471a0377eeeb7793f83450cd514d0b43e7a39",
                    "Gateway": "172.18.0.1",
                    "IPAddress": "172.18.0.2",
                    "IPPrefixLen": 16,
                    "IPv6Gateway": "",
                    "GlobalIPv6Address": "",
                    "GlobalIPv6PrefixLen": 0,
                    "MacAddress": "02:42:ac:12:00:02",
                    "DriverOpts": null
                }
            }
        }
    }
]
  </code>
  </pre>
</details>



<p><strong>进入当前正在运行的容器</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 通常容器都是使用后台方式运行的，需要进入容器修改一些配置
# -it  通过交互模式运行

[root@qing /]$ docker exec -it 容器id /bin/bash  # 进入后台运行的容器，/bin/bash 位置		开启一个新的终端，可以进行一些操作(常用)

[root@qing /]$ docker attach 容器id		#  进入正在执行的容器	进入正在运行的中断，不会启动新的进程<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><strong>从容器内拷贝文件到宿主机</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ docker cp 容器id:容器内路径	目的主机路径	# 容器内文件拷贝到主机

# test 进入之前启动的centos容器内

[root@qing /]$ docker ps
[root@qing /]$ docker attach ${id}
[root@qing /]$ ls
[root@qing /]$ cd /home
[root@qing /]$ touch test.java
[root@qing /]$ exit # 注意 此处是退出了容器，容器停止运行，但是在没有被清理时容器的数据依旧存在
[root@qing /]$ docker ps -a
[root@qing /]$ docker cp ${id}:/home/test.java /home # 类似与socp命令

## 拷贝时一个手动的过程，后期使用中可以通过 -v 卷的方式，实现自动同步，将容器中的目录与宿主机的进行同步<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><strong>其他</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">
[root@qing /]$ docker --help<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<p><img src="/2021/12/25/devops/docker-notes/0005.png" alt="0005"></p>
<h4 id="命令小结"><a href="#命令小结" class="headerlink" title="命令小结"></a>命令小结</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ docker attach      
# Attach local standard input, output, and error streams to a running container		
# 当前shell下attach连接指定运行镜像

[root@qing /]$ docker build
# Build an image from a Dockerfile
# 通过Dockerfile 定制镜像

[root@qing /]$ docker commit
# Create a new image from a container's changes
# 提交当前容器为新的镜像

[root@qing /]$ docker cp
# Copy files/folders between a container and the local filesystem
# 从容器中拷贝指定文件或目录到宿主机中

[root@qing /]$ docker create
# Create a new container
# 创建一个新的容器，同run，但不启动容器

[root@qing /]$ docker diff
# Inspect changes to files or directories on a container's filesystem
# 查看docker容器的变化

[root@qing /]$ docker events
# Get real time events from the server
# 从docker服务获取容器实时事件

[root@qing /]$ docker exec
# Run a command in a running container
# 在已存在的容器上运行命令

[root@qing /]$ docker export
# Export a container's filesystem as a tar archive
# 到处容器的内容流作为一个tar归档文件，对应import

[root@qing /]$ docker history
# Show the history of an image
# 查看一个镜像的历史

[root@qing /]$ docker images
# List images
# 列出当前系统中所有的镜像

[root@qing /]$ docker import
# Import the contents from a tarball to create a filesystem image
# 从tar包中的内容创建一个新的文件系统，对应export

[root@qing /]$ docker info
# Display system-wide information
# 显示系统相关信息

[root@qing /]$ docker inspect
# Return low-level information on Docker objects
# 查看容器详细信息

[root@qing /]$ docker kill
# Kill one or more running containers
# kill指定docker容器

[root@qing /]$ docker load
# Load an image from a tar archive or STDIN
# 从一个tar包中加载一个镜像，对应save

[root@qing /]$ docker login
# Log in to a Docker registry
# 注册或者登录一个docker源服务器

[root@qing /]$ docker logout
# Log out from a Docker registry
# 从当前docker registry退出

[root@qing /]$ docker logs
# Fetch the logs of a container
# 输出当前容器日志信息

[root@qing /]$ docker pause
# Pause all processes within one or more containers
# 暂停容器

[root@qing /]$ docker port
# List port mappings or a specific mapping for the container
# 查看映射端口对应容器内幕源端口

[root@qing /]$ docker ps
# List containers
# 列出容器列表

[root@qing /]$ docker pull
# Pull an image or a repository from a registry
# 从docker镜像源服务器拉取指定镜像或者库镜像

[root@qing /]$ docker push
# Push an image or a repository to a registry
# 推送指定镜像或者库镜像到dicker源服务器

[root@qing /]$ docker rename
# Rename a container
# 对容器重命名

[root@qing /]$ docker restart
# Restart one or more containers
# 重启运行的容器

[root@qing /]$ docker rm
# Remove one or more containers
# 移除一个或者多个容器

[root@qing /]$ docker rmi
# Remove one or more images
# 移除一个或者多个镜像，五容器使用该镜像才可删除，否则需要删除相关容器才可以或者强制删除

[root@qing /]$ docker run
# Run a command in a new container
# 创建一个新的容器并运行一个命令

[root@qing /]$ docker save
# Save one or more images to a tar archive (streamed to STDOUT by default)
# 保存一个镜像为一个tar包，对应load

[root@qing /]$ docker search
# Search the Docker Hub for images
# 在docker hub中搜索镜像

[root@qing /]$ docker start
# Start one or more stopped containers
# 启动容器

[root@qing /]$ docker stats
# Display a live stream of container(s) resource usage statistics
# 显示容器资源的状态

[root@qing /]$ docker stop
# Stop one or more running containers
# 停止容器

[root@qing /]$ docker tag
# Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE
# 给源镜像打一个标签

[root@qing /]$ docker top
# Display the running processes of a container
# 查看容器中运行的进程信息

[root@qing /]$ docker unpause
# Unpause all processes within one or more containers
# 取消暂停容器

[root@qing /]$ docker update
# Update configuration of one or more containers
# 更新一个或者多个容器的配置

[root@qing /]$ docker version
# Show the Docker version information
# 查看docker版本号

[root@qing /]$ docker wait
# Block until one or more containers stop, then print their exit codes
# 截取容器停止时的退出状态值。
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="test"><a href="#test" class="headerlink" title="test"></a>test</h3><h4 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ docker search nginx
[root@qing /]$ docker pull nginx
[root@qing /]$ docker run -d --name nginx00 -p 2233:80 nginx
# 后台启动nginx 并设置名称 nginx00 映射端口 宿主机2233 -&gt; 容器80
[root@qing /]$ docker ps
[root@qing /]$ curl localhost:2233
[root@qing /]$ docker exec -it nginx00 /bin/bash

root@fca2fac49368:/$ whereis nginx 

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><strong>存在问题</strong></p>
<p>每次改动nignx配置文件，都需要进入容器内部，十分的麻烦</p>
<p><strong>解决方案</strong></p>
<p>在容器外部宿主机上提供一个映射路径，达到在容器外修改文件，容器内不就可以修改的目的，-v 数据卷</p>
</blockquote>
<h4 id="tomcat"><a href="#tomcat" class="headerlink" title="tomcat"></a><strong>tomcat</strong></h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ docker run -it --rm tomcat:9.0 # 一般用来测试，用完就删除，及--rm
[root@qing /]$ docker search tomcat
[root@qing /]$ docker pull tomcat:9.0
[root@qing /]$ docker run -d --name tomcat9.0_00 -p 2233:8080 tomcat:9.0
[root@qing /]$ docker ps
[root@qing /]$ curl localhost:2233
root@714059eea83c$ docker exec -it tomcat9.0_00 /bin/bash
ls -al
cd /usr/local/tomcat
cp -r webapps.dist/* webapps
# 实际上，这里启动的时阉割版镜像，及默认最小的镜像，所以不必要的都被剔除掉了
# 故：linux命令少，没有webapps。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>存在问题</p>
<p>每次部署项目，需要进入到容器进行拷贝文件十分麻烦。如果所有的文件都放到容器内部，eg. mysql 如果删除了镜像或者容器，导致所有数据丢失？</p>
<p>解决方案</p>
<p>同上</p>
</blockquote>
<h4 id="es-kibana"><a href="#es-kibana" class="headerlink" title="es+kibana"></a><strong>es+kibana</strong></h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># elasticsearch 暴露的端口很多、十分的耗内存、数据一般需要放置到安全目录 挂载
# 官方启动命令
# $ docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" elasticsearch:tag
# --net somenetwork ？ docker的网络配置

[root@qing /]$ docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" elasticsearch:7.6.2
# 启动后十分的卡 docker stats 查看cpu状态
[root@qing /]$ docker stats  ${id}?
[root@qing /]$ docker stop elasticsearch
# 添加限制的启动
[root@qing /]$ docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" -e ES_JAVA_OPTS="-Xms64m -Xmax512m" elasticsearch:7.6.2

[root@qing /]$ curl localhost:9200
####################################
# kibana 连接  es
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h3><ul>
<li>portainer</li>
<li>rancher（CI/CD）</li>
</ul>
<h4 id="portainer"><a href="#portainer" class="headerlink" title="portainer"></a>portainer</h4><p>Docker图像化管理工具，提供了一个后台面板</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">root@qing /]$ docker run -d -p 8088:9000 \
--restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer

# -v 挂载  宿主机:容器
# --privileged 授权<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h2 id="Docker镜像"><a href="#Docker镜像" class="headerlink" title="Docker镜像"></a>Docker镜像</h2><h3 id="镜像是什么"><a href="#镜像是什么" class="headerlink" title="镜像是什么"></a>镜像是什么</h3><p>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时的库、环境变量和配置文件</p>
<p>所有的应用，直接打包docker镜像，就可以直接跑起来</p>
<ul>
<li>从远程仓库pull</li>
<li>拷贝文件</li>
<li>自己制作一个镜像 dockerFile</li>
</ul>
<h3 id="Docker镜像加速原理"><a href="#Docker镜像加速原理" class="headerlink" title="Docker镜像加速原理"></a>Docker镜像加速原理</h3><blockquote>
<p>UnionFS（联合文件系统）</p>
</blockquote>
<p>UnionFS（联合文件系统）：Union文件系统是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下（unite several directories into a single virtual file system）。Union文件系统时Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p>
<p>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录</p>
<blockquote>
<p>Docker镜像加载原理</p>
</blockquote>
<p>docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。</p>
<p>bootfs（boot file system）主要包含bootloader和kernel，bootloader主要是引导加载kernel，Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层就是bootfs。这一层与我们典型的Linux/Unix系统一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已有bootfs转交给内核，此时系统也会卸载bootfs。</p>
<p>rootfs（root file system），在bootfs之上，包含典型Linux系统中的/dev 、/proc、/bin、/etc等标准目录和文件。rootfs就是各种不同的操作系统发行版本，eg. Ubuntu Centos…</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ docker inspect 镜像id		# 查看镜像信息

# rootFS
#  "RootFS": {
#             "Type": "layers",
#             "Layers": [
#                 "sha256:764055ebc9a7a290b64d17cf9ea550f1099c202d83795aa967428ebdf335c9f7",
#                 "sha256:71a14cc55692a4edac5da18be420acf085c681ec95f7af5ff64bb1c236440d59",
#                 "sha256:50854886015e8e202f3197c6a95ae60632a432aba673188bb7c3f9ee80ed2f30",
#                 "sha256:1952fb2b0eb4d355f05a815c6d804243f089e05c0b8f3b1c1eaf0a1109e8293a",
#                 "sha256:893f6aea2ce23f813c44180ccb7a41e8a4d151cb02f7c365cc4e837c0872b211",
#                 "sha256:b8d0aeaeeee8ed55cb6bfc7e061d0bb0491e91024790c45d0c56b07c29cea080",
#                 "sha256:d7cde20f3f6895bd6e6b2ef5767ee60d7034babe62093340ac22df5c8622db74",
#                 "sha256:ae8fcba6091c17b6691f9a1c49621f193e2f475b3eee44d83b4f78b0d0fd31ae",
#                 "sha256:1a4de2199d77be12009ed995b8db1c5a85d9a9b5e19673a8af4824de03f4ce0a",
#                 "sha256:eeabd280c12ee308111950fd99ba8ffdd75130b6d948ba6a34fe6221b82f20dd",
#                 "sha256:cd0c4980990f734130353adfa00f88ba57bc946b868468d633eeb75abd465fa0",
#                 "sha256:027a41439ba438753333f44da1bc57b86e2211f708ace53343cc733151dc2380"
#             ]
#         },<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>精简后的OS，rootfs可以很小，只包含最基本的命令，工具和程序库就可以了，因为底层直接用Host到Kernel，自己只需要提供rootfs就可以了。达到公用bootfs的目的。</p>
<p><img src="/2021/12/25/devops/docker-notes/0006.png" alt="0006"></p>
<p><img src="/2021/12/25/devops/docker-notes/0007.png" alt="0007"></p>
<blockquote>
<p>进一步说明</p>
</blockquote>
<p>所有的Docker镜像都起始于一个既相互镜像层，当进行修改或者增加新的内容时，就会在当前镜像层之上，创建一个新的镜像层。</p>
<p><img src="/2021/12/25/devops/docker-notes/0008.png" alt="0008"></p>
<p>在添加额外的镜像层的同时，镜像始终保持是当前所有镜像的组合。及每个镜像层包含了3个文件，而镜像包含了来及两个镜像层的六个文件</p>
<p><img src="/2021/12/25/devops/docker-notes/0009.png" alt="0009"></p>
<p>一个稍微复杂的三层镜像，在外部看来整个镜像只有6个文件，因为最上层中的app2.0是app1.0的一个更新版本。</p>
<p><img src="/2021/12/25/devops/docker-notes/0010.png" alt="0010"></p>
<p>这种情况下，上层镜像层中的文件覆盖了底层镜像层中的文件，使得文件的更新版本作为一个新镜像层添加到镜像中。</p>
<p>Docker通过存储引擎（新版本采用快照机制）的方式来实现镜像层堆栈，并保证多镜像层对外展示为统一 文件系统。</p>
<p>Linux上可用的存储引擎由AUFS、Overlay2、Device Mapper、Btrfs以及ZFS。顾名思义，每种存储引擎都基于Linux中对应的文件系统或者块设备技术，并且每种存储引擎都有其独特的性能特点</p>
<p>Docker在Windows上仅支持windowsfilter一种存储引擎，该引擎基于NTFS文件系统之上实现了分层和CoW [①]。</p>
<p>所有镜像层堆叠合并后，对外统一提供如上图所示的合并图</p>
<blockquote>
<p>特点</p>
</blockquote>
<p>Docker镜像都是只读的，当容器启动是，一个新的可写层被加载到镜像的顶部，这一层就是容器层，容器之下的都是叫镜像层。（无限套娃？？？）</p>
<h3 id="commit镜像"><a href="#commit镜像" class="headerlink" title="commit镜像"></a>commit镜像</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 提交容器成为一个新的副本容器
[root@qing /]$ docker commit
[root@qing /]$ docker commit -m="description" -a="author" 容器id 目标镜像:[TAG]

# test

[root@qing /]$ docker run -it -p 8080:8080 tomcat

# new terminal
[root@qing /]$ docker ps
[root@qing /]$ docker exec -it ${id} /bin/bash
root@sdfj0adf98 /$ cd /usr/local/tomcat
root@sdfj0adf98 /$ cp -r webapps.dist/* webapps 


[root@qing /]$ docker commit -m="description" -a="author" 容器id 目标镜像:[TAG]
[root@qing /]$ docker images<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2021/12/25/devops/docker-notes/0011.png" alt="0011"></p>
<h2 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h2><p>Q：数据可用放在容器里面么？</p>
<p>A：不能，因为容器如果被删除，会导致数据永久的丢失，所以需要<strong>数据持久化</strong></p>
<p>所以就有了容器的卷技术，容器之间可用有一个数据共享，将Docker容器中产生的数据同步到本地中 —— 目录挂载，将我们容器内的目录，挂载到Linux上面。将宿主机的内存共享给容器，双向绑定。</p>
<p><strong>容器持久化和同步操作，容器间也可以数据共享。</strong></p>
<h3 id="挂载链接"><a href="#挂载链接" class="headerlink" title="挂载链接"></a>挂载链接</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 直接使用命令来挂载 -v
[root@qing /]$ docker run -it 主机目录:容器目录 （镜像）

[root@qing /]$ docker run -it -v /home/ceshi:/home centos /bin/bash

[root@qing /]$ docker inspect 容器Id
# “Mounts”

[root@qing /]$ cd /home/ceshi
[root@qing /]$ ls
# 在容器内创建文件
[root@sdfuo098sadf /]$ ls /home
[root@sdfuo098sadf /]$ touch test.java

# 在宿主机中查看是否文件被同步创建
[root@qing /]$ ls /home/ceshi

# [root@qing /]$ docker exec -it 容器id /bin/bash  # 进入后台运行的容器，/bin/bash 位置		开启一个新的终端，可以进行一些操作(常用)

[root@qing /]$ docker attach 容器id		#  进入正在执行的容器	进入正在运行的中断，不会启动新的进程
[root@sdfuo098sadf /]$ exit
# 退出容器后，在宿主机上修改文件
[root@qing /]$ vim /home/ceshi/test.java

# 重新启动容器，查看容器中的该文件是被同步修改<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 拉取镜像
[root@qing /]$ docker pull mysql:5.7

# 官方的启动命令
# 启动容器时挂载目录, 配置密码
# -e 环境配置
# $ docker run -it --network some-network --rm mysql mysql -hsome-mysql -uexample-user -p
[root@qing /]$ docker run -d -p 2233:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7
		
# 可用连接创建数据库查看是否持久化成功。


[root@qing /]$ docker rm -f mysql01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="具名挂载和匿名挂载"><a href="#具名挂载和匿名挂载" class="headerlink" title="具名挂载和匿名挂载"></a>具名挂载和匿名挂载</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">
# 不指定主机目录，会自动挂载
[root@qing /]$  docker run -d -P --name nginx01 -v /etc/nginx nginx
# 注意 -v 后不添加/ 表明不是目录
[root@qing /]$  docker run -d -P --name nginx02 -v juming_nginx:/etc/nginx nginx
# 查看所有的卷情况
[root@qing /]$ docker volume ls
DRIVER    VOLUME NAME
local     0a99e217ac4ba4842c205b7fe1aae0146425e56b96df7628d78e10198f1337ce
local     juming_nginx
# 可用看出，第一个就是匿名挂载，在 -v 之后只写了容器内的路径，没有写宿主机的路径
# 第二个就是具名挂载 -v 卷名:容器内路径 

# 查看卷的所在目录

[root@qing /]$ docker volume inspect juming_nginx
[
    {
        "CreatedAt": "2021-12-29T23:28:25+08:00",
        "Driver": "local",
        "Labels": null,
        "Mountpoint": "/var/lib/docker/volumes/juming_nginx/_data",
        "Name": "juming_nginx",
        "Options": null,
        "Scope": "local"
    }
]
# Mountpoint 就是挂载的目录<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>所有的docker容器内的卷，没有指定目录的情况下都是在 <code>/var/lib/docker/volumes/xxxxxx/_data</code></p>
<p>通过具名挂载可用很方便的找到一个卷，通常情况下都是使用具名挂载</p>
<h4 id="挂载小总结"><a href="#挂载小总结" class="headerlink" title="挂载小总结"></a>挂载小总结</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 具名挂载、匿名挂载、指定路径挂载
-v 容器内路径	# 匿名挂载
-v 卷名:容器内路径		# 具名挂载
-v /宿主机路径:容器内路径		# 指定路径挂载


# 通过 -v 容器内路径:ro rw 改变读写权限
# 一旦设置了容器权限，容器对我们挂载出来的容器就有了限定 
# ro 这个路径就只能通过宿主机来操作，容器内部是无法操作的
[root@qing /]$ docker run -d -P --name nginx03: -v juming_nginx:/etc/nginx:ro nginx
[root@qing /]$ docker run -d -P --name nginx04 -v juming_nginx:/etc/nginx:rw nginx
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="dockerFile实现挂载"><a href="#dockerFile实现挂载" class="headerlink" title="dockerFile实现挂载"></a>dockerFile实现挂载</h3><p>命令脚本，可用通过这个脚本来生成镜像，镜像是一层一层的卷，脚本就是一个一个的命令，每个命令就是一层！</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ mkdir /home/docker-test-volume
# 创建dockerFile文件
[root@qing /]$ vim dockerFile1
#############################dockerFile1##############
FROM centos

VOLUME ["volume01","volume02"]

CMD echo "------end------"
CMD /bin/bash
############################dockerFile1##############

# 根据dockerFile 生成镜像
[root@qing /]$ docker build -f ./dockerFile1 -t qing/centos:1.0 .
Sending build context to Docker daemon  240.7MB
Step 1/4 : FROM centos
 ---&gt; 5d0da3dc9764
Step 2/4 : VOLUME ["volume01","volume02"]
 ---&gt; Running in eb142d0e83ad
Removing intermediate container eb142d0e83ad
 ---&gt; ba3e07adb20b
Step 3/4 : CMD echo "------end------"
 ---&gt; Running in 372a86750520
Removing intermediate container 372a86750520
 ---&gt; 8feb17962dff
Step 4/4 : CMD /bin/bash
 ---&gt; Running in b198098a4925
Removing intermediate container b198098a4925
 ---&gt; 0a15ea858d6b
Successfully built 0a15ea858d6b
Successfully tagged qing/centos:1.0

# 查看镜像
[root@qing /]$ docker images
REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
qing/centos   1.0       0a15ea858d6b   6 seconds ago   231MB

[root@qing /]$ docker run -it qing/centos:1.0 bash
[root@ef4ca52a471a /]# ls
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var  volume01	volume02

[root@qing /]$ docker inspect ef4ca52a471a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="容器间共享数据"><a href="#容器间共享数据" class="headerlink" title="容器间共享数据"></a>容器间共享数据</h3><p>通过数据卷容器来达到容器间的共享</p>
<p><img src="/2021/12/25/devops/docker-notes/0015.png" alt="0015"></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 启动父容器
[root@qing /]$ docker run -it --name docker01 qing/centos:1.0 bash

# 启动第二个
[root@qing /]$ docker run -it --name docker02 --volumes-from docker01 qing/centos:1.0 bash

# 在父容器中创建文件 会被同步到子容器中<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意：这里其实是容器都挂载到宿主机的同一个目录下了，并不是多个目录之间在同步，如果删除宿主机下的这个目录的文件，容器内的数据就会消失</p>
<h2 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h2><p>dockerFile 是用来构建docker镜像的构建脚本。</p>
<p>大致步骤</p>
<ol>
<li>编写一个dockerFile文件</li>
<li>docker build 构建一个镜像</li>
<li>docker  run 运行镜像</li>
<li>docker push 发布镜像 </li>
</ol>
<blockquote>
<p>每个保留关键字（指令）都是大写</p>
<p>执行从上到下顺序执行</p>
<p>/# 表示注释</p>
<p>每个指令都会创建提交一个新的镜像层，并提交。</p>
</blockquote>
<p><img src="/2021/12/25/devops/docker-notes/0016.png" alt="0016"></p>
<h3 id="指令简述"><a href="#指令简述" class="headerlink" title="指令简述"></a>指令简述</h3><table>
<thead>
<tr>
<th>指令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>FROM</td>
<td>基础镜像，从这里开始</td>
</tr>
<tr>
<td>MAINTAINER</td>
<td>镜像的作者</td>
</tr>
<tr>
<td>RUN</td>
<td>镜像构建的时候需要运行的命令</td>
</tr>
<tr>
<td>ADD</td>
<td>编译镜像时复制文本到镜像中</td>
</tr>
<tr>
<td>COPY</td>
<td>类似ADD，将文件拷贝到镜像中</td>
</tr>
<tr>
<td>WORKDIR</td>
<td>镜像的工作目录，设置RUN CMD ENTRYPOINT COPY ADD指令的工作目录</td>
</tr>
<tr>
<td>LABEL</td>
<td>设置镜像的标签</td>
</tr>
<tr>
<td>VOLUME</td>
<td>挂载的目录</td>
</tr>
<tr>
<td>EXPOSE</td>
<td>设置镜像暴露的端口</td>
</tr>
<tr>
<td>CMD</td>
<td>指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被代替</td>
</tr>
<tr>
<td>ENTRYPOINT</td>
<td>指定这个容器启动的时候要运行的命令，可用追加命令</td>
</tr>
<tr>
<td>ONBUILD</td>
<td>当构建一个被继承DockerFile这个时候就会运行onbuild的指令，触发指令</td>
</tr>
<tr>
<td>ARG</td>
<td>设置编译镜像时加入的参数</td>
</tr>
<tr>
<td>ENV</td>
<td>构建的时候设置的环境变量</td>
</tr>
<tr>
<td>USER</td>
<td>设置运行RUN CMD ENTRYPOINT的用户名</td>
</tr>
<tr>
<td>STOPSIGNAL</td>
<td>设置容器的退出信号量</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h3><p>Docker Hub中99%镜像都是从一个基础镜像scratch过来的。</p>
<blockquote>
<p>FROM scratch</p>
</blockquote>
<h4 id="制作一个简单的centos扩展镜像"><a href="#制作一个简单的centos扩展镜像" class="headerlink" title="制作一个简单的centos扩展镜像"></a>制作一个简单的centos扩展镜像</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ vim docker_file_centos
############################docker_file_centos##############
FROM centos
MAINTAINER qing&lt;111@qq.com&gt;

ENV MYPATH /usr/local
WORKDIR $MYPATH

RUN yum -y install vim
RUN yum -y insatll net-tools

EXPOSE 80

CMD echo "------end-----"

CMD /bin/bash
############################docker_file_centos##############

# 在官方的centos基础上添加了vim 和 net-tools
[root@qing /]$ docker build -f home/doker_files/docker_file_centos -t qing/centos:1.1 .
# 可用启动测试下 ipconfig vim 命令


# 查看下镜像构建的历史
[root@qing /]$ docker history 镜像id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="使用tar制作tomcat镜像"><a href="#使用tar制作tomcat镜像" class="headerlink" title="使用tar制作tomcat镜像"></a>使用tar制作tomcat镜像</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ ls
apache-tomcat-9.0.56.tar.gz jdk1.8.0_181
[root@qing /]$ touch readme.md
[root@qing /]$ vim Dockerfile # 该命令 build是会自动讯在，不用-f指定 
############################Dockerfile##############
FROM centos
MAINTAINER qing&lt;111@qq.com&gt;

COPY readme.md /usr/local/readme.txt
# 直接复制
COPY jdk1.8.0_181/ /usr/local/jdk1.8.0_181/
# 会自动解压
ADD apache-tomcat-9.0.56.tar /usr/local/

RUN yum -y install vim 

ENV MYPATH /usr/local
WORKDIR $MYPATH

ENV JAVA_HOME /usr/local/jdk1.8.0_181
ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar

ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.56
ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.56
ENV PATH $PATH:$JAVA_HOEM/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin

EXPOSE 8080

CMD /usr/local/apache-tomcat-9.0.56/bin/startup.sh &amp;&amp; tail -F /url/localapache-tomcat-9.0.56/bin/logs/catalina.out

############################Dockerfile##############


# 构建启动
[root@qing /]$ docker build -t qing/tomcat:1.0 .
[root@qing /]$ docker images
[root@qing /]$ docker run -d -p 2233:8080 --name qingtomcat -v /home/qing/tomcat/test:/usr/local/apache-tomcat-9.0.56/webapps/test -v /home/qing/tomcat/logs:/usr/local/apache-tomcat-9.0.56/logs qing/tomcat:1.0

# 测试
[root@qing /]$ curl localhost:2233<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">[root@qing /]$ mkdir /home/qing/tomcat/test/EB-INF
[root@qing /]$ cd /home/qing/tomcat/test/EB-INF
[root@qing /]$ vim web.xml
############################web.xml##############
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns="http://java.sun.com/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
                             http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
         ersion="2.5"&gt;

&lt;/web-app&gt;
  
############################web.xml##############

[root@qing /]$ cd ..
[root@qing /]$ vim index.jsp
############################index.jsp##############
&lt;html&gt;
&lt;head&gt;&lt;title&gt;Hello World&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
Hello World!&lt;br/&gt;
&lt;%
System.out.println("Your IP address is " + request.getRemoteAddr());
%&gt;
&lt;/body&gt;
&lt;/html&gt;
############################index.jsp##############<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="命令说明"><a href="#命令说明" class="headerlink" title="命令说明"></a>命令说明</h3><h4 id="CMD和ENTRYPOINT的区别"><a href="#CMD和ENTRYPOINT的区别" class="headerlink" title="CMD和ENTRYPOINT的区别"></a>CMD和ENTRYPOINT的区别</h4><ul>
<li>CMD<ul>
<li>启动的时候如果在最后追加了命令会替换掉镜像中的命令</li>
</ul>
</li>
<li>ENRYPOINT<ul>
<li>启动后如果在最后追加了命令，不会替换镜像中的命令，而是在其后追加</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ vim docker_file_cmd
############################docker_file_cmd##############
FROM centos
CMD ["ls","-a"]
############################docker_file_cmd##############

# 在官方的centos基础上添加了vim 和 net-tools
[root@qing /]$ docker build -f home/doker_files/docker_file_cmd -t qing/centos:1.2 .
# 直接运行会发现 ls -a 执行了
[root@qing /]$dovker run centos:1.2

# 追加命令执行
[root@qing /]$dovker run centos:1.2 -l
error<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ vim docker_file_entrypoint
############################docker_file_entrypoint##############
FROM centos
ENTRYPOINT ["ls","-a"]
############################docker_file_entrypoint##############

# 在官方的centos基础上添加了vim 和 net-tools
[root@qing /]$ docker build -f home/doker_files/docker_file_entrypoint -t qing/centos:1.3 .
# 直接运行会发现 ls -a 执行了
[root@qing /]$ dovker run centos:1.2

# 追加命令执行，会发现 执行了 ls -a -l
[root@qing /]$ dovker run centos:1.2 -l<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="发布镜像"><a href="#发布镜像" class="headerlink" title="发布镜像"></a>发布镜像</h3><h4 id="DockerHub"><a href="#DockerHub" class="headerlink" title="DockerHub"></a>DockerHub</h4><ol>
<li><p>地址<a target="_blank" rel="noopener" href="http://hub.docker.com/">http://hub.docker.com/</a> 注册自己的账号</p>
</li>
<li><p>在服务器上提交自己的镜像</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 登录自己账户号
[root@qing /]$ docker login -u qing
Password:

Login Succeeded

# 提交镜像 尽量带上自己的版本号
[root@qing /]$ docker push  qing/tomcat:1.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h4 id="阿里云容器镜像服务"><a href="#阿里云容器镜像服务" class="headerlink" title="阿里云容器镜像服务"></a>阿里云容器镜像服务</h4><ol>
<li>登录阿里云，找到容器镜像服务</li>
<li>根据需求创建命名空间、</li>
<li>创建容器镜像</li>
<li>根据阿里云上的操作指南进行提交</li>
</ol>
<h2 id="流程小结"><a href="#流程小结" class="headerlink" title="流程小结"></a>流程小结</h2><p><img src="/2021/12/25/devops/docker-notes/0017.png" alt="0017"></p>
<h2 id="Docker-网络"><a href="#Docker-网络" class="headerlink" title="Docker 网络"></a>Docker 网络</h2><h3 id="实验查看"><a href="#实验查看" class="headerlink" title="实验查看"></a>实验查看</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 查看IP地址
[root@qing /]$ ip addr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2021/12/25/devops/docker-notes/0018.png" alt="0018"></p>
<p>Q：docker如何处理容器网络访问的？</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ docker run -d -P --name tomcat01 tomcat

# 查看容器的内部Ip地址
[root@qing /]$ docker exec -it tomcat01 ip addr
## 如果 报错 OCI runtime exec failed: 
## 因为该tomcat镜像为了最小化，可能没有安装ip addr命令，故需要安装 iproute2
# [root@qing /]$ docker exec -it tomcat01 bash
# root@bd19d226252e $ apt update &amp;&amp; apt install -y iproute2

# 再次输入
[root@qing /]$ docker exec -it tomcat01 ip addr
# 查看一下容器的内部网络地址，发现容器启动的时候会得到一个eth0@if61的ip地址，该地址是由docker分配的 详细见 图0019
       
# 可用通过宿主机ping 改ip
[root@qing /]$ ping 172.18.0.2

# 与图片0018中的 docker0 172.18.0.1/16 可用得知该网络与docker0属于同一个网段<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2021/12/25/devops/docker-notes/0019.png" alt="0019"></p>
<h3 id="原理简述"><a href="#原理简述" class="headerlink" title="原理简述"></a>原理简述</h3><ol>
<li><p>每启动一个docker容器，docker就会给docker容器分配一个ip，只要安装了docker，就会有一个网卡docker0。通过桥接模式，使用的技术veth-pair技术进行连接。</p>
</li>
<li><p>再次在宿主机测试<code>ip addr</code>，对比图0019和图0020，可以看到了宿主机多了一个网卡，序号上与容器中是对应的</p>
<blockquote>
<p>容器带来的网卡都是一对存在的</p>
<p>veth-pair 就是一对虚拟设备接口，都是成对出现，一段连着协议，一段彼此相连。基于此特性，veth-pair充当一个桥梁，连接各种虚拟网络设备的</p>
<p>OpenStac、Docker容器之间的连接、OVS的连接，都是使用veth-pair 技术</p>
</blockquote>
<p><img src="/2021/12/25/devops/docker-notes/0020.png" alt="0020"></p>
</li>
<li><p>所以在启动多个容器的时候，由于都是由docker0分配的网卡的ip都属于同一个网段，所以容器之间也是可以相互访问的。</p>
</li>
</ol>
<p><img src="/2021/12/25/devops/docker-notes/0021.png" alt="0021"></p>
<ol start="4">
<li>所以，在启动容器时不指定网络的情况下，都是哟docker来分配一个默认的可用IP，且由docker0来进行路由</li>
</ol>
<p><strong>小结</strong></p>
<blockquote>
<p>Docker使用的是Linux的桥接，宿主机中的一个网卡docker0就是Docker的网桥 </p>
<p>docker中的所有网络接口都是虚拟的，虚拟的转发效率高、</p>
</blockquote>
<p><img src="/2021/12/25/devops/docker-notes/0022.png" alt="0022"></p>
<h3 id="容器互联"><a href="#容器互联" class="headerlink" title="容器互联"></a>容器互联</h3><h4 id="–Link"><a href="#–Link" class="headerlink" title="–Link"></a>–Link</h4><blockquote>
<p>但是并不推荐使用 –link 进行容器连接。因为部分的自定义网络不适于使用docker0 进行路由，例如：不支持使用容器名进行连接</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ docker run -d -P --name tomcat01 tomcat
[root@qing /]$ docker run -d -P --name tomcat02 tomcat
# 直接在容器间进行ping
[root@qing /]$ docker exec -it tomcat02 ping tomcat01
## 如果 报错 OCI runtime exec failed: 
## 不支持ping命令时，则需要进入容器手动安装该命令
# [root@qing /]$ docker exec -it tomcat02 bash
# root@bd19d226252e $ apt update &amp;&amp; apt install iputils-ping
ping: tomcat01: Name or service not known  # 可知无法与tomcat01进行通信

[root@qing /]$ docker run -d -P --name tomcat03 --link tomcat02 tomcat
# 如果不存在ping命令，则需要同上面的方式安装 

[root@qing /]$ docker exec -it tomcat03 ping tomcat02
PING tomcat02 (172.18.0.3) 56(84) bytes of data.
64 bytes from tomcat02 (172.18.0.3): icmp_seq=1 ttl=64 time=0.104 ms
64 bytes from tomcat02 (172.18.0.3): icmp_seq=2 ttl=64 time=0.059 ms

# 可用发现 通过--link 便可以在容器之间 通过服务名联通(不用指定ip)

# 但是反向却无法ping通
[root@qing /]$ docker exec -it tomcat02 ping tomcat03<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>这里 –link 是将tomcat03对tomcat02的连接添加到了配置项中，所以可用tomcat03可用访问到tomcat02。使用inspect命令查看docker的元数据可以看到如下配置</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ docker inspect tomcat03<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2021/12/25/devops/docker-notes/0023.png" alt="0023"></p>
<blockquote>
<p>也可以通过查看hosts配置</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ docker exec -it tomcat03 cat /etc/hosts
# 可以理解为在host文件中添加了域名映射<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2021/12/25/devops/docker-notes/0024.png" alt="0024"></p>
<h3 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@qing /]$ docker network ls # 查看所有网络<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p><img src="/2021/12/25/devops/docker-notes/0025.png" alt="0025"></p>
<h4 id="网络模式"><a href="#网络模式" class="headerlink" title="网络模式"></a>网络模式</h4><ul>
<li>bridge：桥接模式 （docker 默认）</li>
<li>none：不配置网络</li>
<li>host：与宿主机共享模式</li>
<li>container：容器网络连通（局限较大）</li>
</ul>
<h4 id="自定义网络-1"><a href="#自定义网络-1" class="headerlink" title="自定义网络"></a>自定义网络</h4><blockquote>
<p>可以修复docker0中，在不适用–link是，不支持直接使用容器名进行连接</p>
</blockquote>
<p><strong>自定义网络选择使用bridge模式</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 直接启动的容器，有一个默认参数为： --net bridge，这里使用的就是docker0
# docker run -d -P --name tomcat01 --net bridge tomcat


# 自定义一个网络
[root@qing /]$ docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet
## --driver 连接模式
## --subnet 子网掩码
## --gateway 路由ip

# 故可以在启动的时候指定使用该自定义的网络
[root@qing /]$ docker run -d -P --name tomcat-net-01 --net mynet tomcat
[root@qing /]$ docker run -d -P --name tomcat-net-02 --net mynet tomcat
# 查看此时自定义网络的元数据
[root@qing /]$ docker network inspect mynet # 图片0026中可以看到容器的网络

# 此时使用自定义的网络直接通过容器名进行ping
[root@qing /]$ docker exec -it tomcat-net-01 ping tomcat-net-02
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2021/12/25/devops/docker-notes/0026.png" alt="0026"></p>
<h4 id="将不同网络连接"><a href="#将不同网络连接" class="headerlink" title="将不同网络连接"></a>将不同网络连接</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 将网络docker0下的tomcat01连接到 mynet网络下（达成一个容器两个ip）
[root@qing /]$ docker network connect mynet tomcat01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<p><img src="/2021/12/25/devops/docker-notes/0027.png" alt="0027"></p>
<h4 id="demo-redis集群"><a href="#demo-redis集群" class="headerlink" title="demo-redis集群"></a>demo-redis集群</h4><blockquote>
<p>分片 集群 高可用</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 创建网卡
[root@qing /]$ docker network create redis --subnet 172.38.0.0/16

# 通过脚本创建六个redis配置
[root@qing /]$ for port in $(seq 1 6); \
do \
mkdir -p /data/qing/redis/node-${port}/conf
touch /data/qing/redis/node-${port}/conf/redis.conf
cat &lt;&lt; EOF &gt;/data/qing/redis/node-${port}/conf/redis.conf
port 6379
bind 0.0.0.0
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
cluster-announce-ip 172.38.0.1${port}
cluster-announce-port 6379
cluster-announce-bus-port 16379
appendonly yes
EOF
done

# 启动六个容器
[root@qing /]$ for port in $(seq 1 6); \
do \
docker run -p 637${port}:6379 -p 1637${port}:16379 --name redis-${port} \
-v /data/qing/redis/node-${port}/data:/data \
-v /data/qing/redis/node-${port}/conf/redis.conf:/etc/redis/redis.conf \
-d --net redis --ip 172.38.0.1${port} redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf; \
done

# 进入容器创建集群
[root@qing /]$ docker exec -it redis-1 /bin/sh
# 创建集群
/data $ redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluste
r-replicas 1
#### 以下为输出 部分省略####
&gt;&gt;&gt; Performing hash slots allocation on 6 nodes...
Master[0] -&gt; Slots 0 - 5460
Master[1] -&gt; Slots 5461 - 10922
Master[2] -&gt; Slots 10923 - 16383
Adding replica 172.38.0.15:6379 to 172.38.0.11:6379
......
......
......
[OK] All nodes agree about slots configuration.
&gt;&gt;&gt; Check for open slots...
&gt;&gt;&gt; Check slots coverage...
[OK] All 16384 slots covered.
#### 以上为输出 ####

# 测试
/data $ redis-cli -c
127.0.0.1:6379&gt; cluster info
127.0.0.1:6379&gt; cluster nodes
127.0.0.1:6379&gt; set a b
-&gt; Redirected to slot [15495] located at 172.38.0.13:6379
OK # 可以看出保存到了3号节点

# 关闭一个容器 测试 172.38.0.13:6379 这里是 13 所以停掉3号
[root@qing /]$ docker stop redis-3

# 在容器内获取刚刚存入的值
127.0.0.1:6379&gt; get a
-&gt; Redirected to slot [15495] located at 172.38.0.14:6379
"b" # 可以看到这里从4号机器中获取
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>















<hr>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://robertsunq.github.io" rel="external nofollow noreferrer">Robert Sunq</a>
                    </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://robertsunq.github.io/2021/12/25/devops/docker-notes/">https://robertsunq.github.io/2021/12/25/devops/docker-notes/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY-SA 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://robertsunq.github.io" target="_blank">Robert Sunq</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/command/">
                                    <span class="chip bg-color">command</span>
                                </a>
                            
                                <a href="/tags/note/">
                                    <span class="chip bg-color">note</span>
                                </a>
                            
                                <a href="/tags/docker/">
                                    <span class="chip bg-color">docker</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,wechat" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2021/12/30/note/command-note/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/19.jpg" class="responsive-img" alt="命令备忘录">
                        
                        <span class="card-title">命令备忘录</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            各类操作系统常用命令备忘录
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-12-30
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/note/" class="post-category">
                                    note
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/command/">
                        <span class="chip bg-color">command</span>
                    </a>
                    
                    <a href="/tags/note/">
                        <span class="chip bg-color">note</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/12/18/tool/git-note/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/7.jpg" class="responsive-img" alt="git_note">
                        
                        <span class="card-title">git_note</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            git的基础操作汇总，相关平台的配置使用。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-12-18
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/tool/" class="post-category">
                                    tool
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/git/">
                        <span class="chip bg-color">git</span>
                    </a>
                    
                    <a href="/tags/tool/">
                        <span class="chip bg-color">tool</span>
                    </a>
                    
                    <a href="/tags/github/">
                        <span class="chip bg-color">github</span>
                    </a>
                    
                    <a href="/tags/configuration/">
                        <span class="chip bg-color">configuration</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2022</span>
            
            <a href="/about" target="_blank">Robert Sunq</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">11.5k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/RobertSunq" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:loading@xx.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=loading..." class="tooltipped" target="_blank" data-tooltip="QQ联系我: loading..." data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
     
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/snow.js"><\/script>');
            }
        </script>
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
